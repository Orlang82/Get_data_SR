SELECT 
	SUBSTR(A.ACCOUNT_NUMBER, 1, 4) AS R020
	, A.AMOUNT_TYPE AS AP
	, A.ID
	, A.ACCOUNT_NUMBER
	, CUR.SHORT_NAME AS VAL
	, A.NAME AS ACC_NAME
	, ACS.AMOUNT AS SUM
	, ACS.BASE_AMOUNT AS SUM_UAH
	, CASE 
		WHEN R011.CODE = '5' THEN '0%'
		WHEN (A.NAME LIKE '%Національний%' AND SUBSTR(A.ACCOUNT_NUMBER, 1, 4) = '9200') THEN '0%'
		WHEN SUBSTR(A.ACCOUNT_NUMBER, 1, 4) = '9200' AND NVL(R013.CODE,'-') = '5' THEN '50%'
		WHEN SUBSTR(A.ACCOUNT_NUMBER, 1, 4) = '9350' AND NVL(R013.CODE,'-') = '2' THEN '50%'
		ELSE '100%'
	  END AS GRP
	, ACS.BASE_AMOUNT * CASE 
		WHEN R011.CODE = '5' THEN 0
		WHEN (A.NAME LIKE '%Національний%' AND SUBSTR(A.ACCOUNT_NUMBER, 1, 4) = '9200') THEN 0
		WHEN SUBSTR(A.ACCOUNT_NUMBER, 1, 4) = '9200' AND NVL(R013.CODE,'-') = '5' THEN 0.5
		WHEN SUBSTR(A.ACCOUNT_NUMBER, 1, 4) = '9350' AND NVL(R013.CODE,'-') = '5' THEN 0.5
		ELSE 1
	  END AS TO_EXPOSURE
	, NVL(R011.CODE,'-') AS SR_R011
	, NVL(R013.CODE,'-') AS SR_R013
FROM SR_BANK.ACCOUNT A
LEFT JOIN SR_BANK.CURRENCY CUR
	ON CUR.ID = A.CURRENCY_ID
LEFT JOIN SR_BANK.CUSTOMER C
	ON C.ID = A.CUSTOMER_ID
LEFT JOIN SR_BANK.ACCOUNT_ATTR_STAT ATS
	ON ATS.ID = A.ID
LEFT JOIN SR_BANK.KL_R011 R011
	ON R011.ID = ATS.KL_R011_ID
LEFT JOIN SR_BANK.KL_R013 R013
	ON R013.ID = ATS.KL_R013_ID
LEFT JOIN SR_BANK.KL_S245 S245
	ON S245.ID = ATS.KL_S245_ID
LEFT JOIN SR_BANK.KL_S580 S580
	ON S580.ID = ATS.KL_S580_ID
LEFT JOIN SR_BANK.KL_R019 R019
	ON R019.ID = ATS.KL_R019_ID
LEFT JOIN SR_BANK.ACCOUNT_SNAPSHOT ACS
	ON ACS.ACCOUNT_ID = A.ID
WHERE 1=1
	AND A.IS_OPEN = 'T'
	AND ACS.BASE_AMOUNT <> 0
	AND SUBSTR(A.ACCOUNT_NUMBER, 1, 4) IN (1811, 1819, 9200, 9350)
	AND ACS.SNAPSHOT_DATE = TO_DATE(:date_param, 'DD.MM.YYYY')
ORDER BY 1